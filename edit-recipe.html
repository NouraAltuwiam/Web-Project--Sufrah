<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تعديل الوصفة</title>

<link href="style.css" rel="stylesheet">




</head>
<body>
  <header>
    <div class="container">
      <!-- header (logo + sign out) -->
      <div id="logo">
        <img src="images/logo.png" alt="Logo">
        <span>سُفرة</span>
      </div>
      <a href="index.html" class="sign-out">تسجيل الخروج</a>
    </div>
  </header>

<div class="form-container">
<h1>تعديل الوصفة</h1>

<form id="editForm">

  <div class="form-group">
    <label>اسم الوصفة:</label>
    <input type="text" id="name" required>
  </div>

  <div class="form-group">
    <label>التصنيف:</label>
    <select id="category" required>
      <option value="">اختر</option>
      <option>إفطار</option>
      <option>سحور</option>
      <option>حلويات</option>
      <option>سناك</option>
    </select>
  </div>

  <div class="form-group">
    <label>الوصف:</label>
    <textarea id="description" required></textarea>
  </div>

  <div class="form-group">
    <label>رفع صورة الوصفة:</label>
    <input type="file" id="photoUpload" accept="image/*" required>
    <div class="media-card" style="display:inline-block; vertical-align:top; margin-right:15px;">
      <h4>الصورة الحالية</h4>
      <div class="preview">
        <img id="photoPreview" alt="">
      </div>
    </div>
  </div>

  
  <div class="section-title">المكونات:</div>
  <div id="ingredientsContainer"></div>
  <button type="button" class="action-btn add-btn" onclick="addIngredientRow()">+ إضافة مكون آخر</button>

  <div class="section-title">طريقة التحضير:</div>
  <div id="stepsContainer"></div>
  <button type="button" class="action-btn add-btn" onclick="addStepRow()">+ إضافة خطوة أخرى</button>

  <!-- فيديو -->
  <div class="section-title">فيديو :</div>
  <div class="form-group">
      <label>رفع فيديو:</label>
      <input type="file" accept="video/*">
    </div>
  
  <div class="form-group">
    <label>رابط الفيديو:</label>
    <input type="url" id="videoUrl" placeholder="https://" style="width:45%;">
    <div class="media-card" style="display:inline-block; vertical-align:top; margin-right:15px;">
      <h4>الفيديو الحالي</h4>
      <div class="preview">
        <video id="videoPreview" controls></video>
      </div>
    </div>
  </div>

  <button type="submit" class="submit-btn">تحديث الوصفة</button>
</form>
</div>
 <footer class="site-footer" role="contentinfo">
  <div class="container footer-inner">

    <!-- عمود: نبذة -->
    <div class="footer-col footer-about">
      <div class="footer-brand">
        <img src="images/logo.png" alt="شعار سُفرة" class="footer-logo">
        <h3 class="footer-title">سُفرة</h3>
      </div>
      <p class="footer-text">
        منصة وصفات رمضانية تساعدك توصل لوصفات الإفطار والسحور بطريقة مرتبة وبسيطة.
      </p>
    </div>

    

    <!-- عمود: استكشاف -->
    <div class="footer-col">
      <h4 class="footer-heading">استكشاف</h4>
      <ul class="footer-links">
        <li><a href="index.html">الرئيسية</a></li>
        <li><a href="my-recipes.html">وصفاتي</a></li>
        <li><a href="add-recipe.html">إضافة وصفة</a></li>
        <li><a href="login.html">تسجيل الدخول</a></li>
      </ul>
    </div>
	
	<!-- عمود: التصنيفات -->
    <div class="footer-col">
      <h4 class="footer-heading">التصنيفات</h4>
      <ul class="footer-links">
        <li><a href="my-recipes.html">إفطار</a></li>
        <li><a href="my-recipes.html">سحور</a></li>
        <li><a href="my-recipes.html">حلويات</a></li>
      </ul>
    </div>

    <!-- عمود: تواصل -->
    <div class="footer-col">
      <h4 class="footer-heading">تواصل معنا</h4>

      <div class="footer-social">
        <a class="social-btn" href="#" aria-label="انستقرام">IG</a>
        <a class="social-btn" href="#" aria-label="إكس">X</a>
        <a class="social-btn" href="#" aria-label="فيسبوك">f</a>
        <a class="social-btn" href="#" aria-label="يوتيوب">▶</a>
      </div>

      <p class="footer-mini">
        البريد: <a href="mailto:sufrah@example.com">sufrah@example.com</a>
      </p>
    </div>

  </div>

  <div class="footer-bottom">
    <div class="container footer-bottom-inner">
      <small>© 2026 سُفرة .</small>
      <small>صُنع بـ <span aria-hidden="true">♥</span> لرمضان</small>
    </div>
  </div>
</footer>

<script>
let recipeData = null;
let ingredientCount = 0;
let stepCount = 0;



function loadRecipeData() {
    try {
        const storedData = localStorage.getItem('editRecipe');
        
        if (!storedData) {
            alert('لم يتم العثور على بيانات الوصفة. يرجى اختيار وصفة للتعديل.');
            return;
        }
        
        recipeData = JSON.parse(storedData);
        console.log('✅ تم جلب الوصفة:', recipeData);
        
        fillFormWithData(recipeData);
        
    } catch (error) {
        console.error('❌ خطأ في قراءة البيانات:', error);
        alert('حدث خطأ في تحميل بيانات الوصفة');
    }
}



function fillFormWithData(recipe) {
    document.getElementById('name').value = recipe.name || '';
    document.getElementById('description').value = recipe.description || '';
    document.getElementById('videoUrl').value = recipe.videoUrl || '';
    
    const categorySelect = document.getElementById('category');
    if (recipe.category) {
        categorySelect.value = recipe.category;
    }
    
    if (recipe.photo) {
        document.getElementById('photoPreview').src = recipe.photo;
    }
    
    if (recipe.video) {
        document.getElementById('videoPreview').src = recipe.video;
    }
    
    const ingredientsContainer = document.getElementById('ingredientsContainer');
    ingredientsContainer.innerHTML = '';
    
    if (recipe.ingredients && recipe.ingredients.length > 0) {
        recipe.ingredients.forEach(ing => {
            addIngredientRow(ing.name, ing.quantity);
        });
    } else {
        addIngredientRow();
    }
    
    const stepsContainer = document.getElementById('stepsContainer');
    stepsContainer.innerHTML = '';
    
    if (recipe.steps && recipe.steps.length > 0) {
        recipe.steps.forEach(step => {
            addStepRow(step);
        });
    } else {
        addStepRow();
    }
}



function addIngredientRow(name = '', quantity = '') {
    ingredientCount++;
    const container = document.getElementById('ingredientsContainer');
    const div = document.createElement('div');
    div.className = 'ingredient-row';
    div.innerHTML = `
        <label>المكون ${ingredientCount}:</label>
        <input type="text" class="ing-name" value="${escapeHtml(name)}" placeholder="الاسم" required>
        <input type="text" class="ing-quantity" value="${escapeHtml(quantity)}" placeholder="الكمية" required>
        <button type="button" class="action-btn delete-btn" onclick="this.parentElement.remove()">حذف</button>
    `;
    container.appendChild(div);
}

function addStepRow(text = '') {
    stepCount++;
    const container = document.getElementById('stepsContainer');
    const div = document.createElement('div');
    div.className = 'step-row';
    div.innerHTML = `
        <label>الخطوة ${stepCount}:</label>
        <input type="text" class="step-text" value="${escapeHtml(text)}" required>
        <button type="button" class="action-btn delete-btn" onclick="this.parentElement.remove()">حذف</button>
    `;
    container.appendChild(div);
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}



document.getElementById('photoUpload').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = function(event) {
            if (!recipeData.photo) recipeData.photo = {};
            recipeData.photo = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    }
});



document.getElementById('editForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    try {
        const updatedRecipe = {
            id: recipeData.id,
            name: document.getElementById('name').value,
            category: document.getElementById('category').value,
            description: document.getElementById('description').value,
            videoUrl: document.getElementById('videoUrl').value,
            photo: recipeData.photo,
            ingredients: [],
            steps: []
        };
        
        document.querySelectorAll('#ingredientsContainer .ingredient-row').forEach(row => {
            const name = row.querySelector('.ing-name').value.trim();
            const quantity = row.querySelector('.ing-quantity').value.trim();
            if (name) {
                updatedRecipe.ingredients.push({ name, quantity });
            }
        });
        
        document.querySelectorAll('#stepsContainer .step-text').forEach(input => {
            const step = input.value.trim();
            if (step) {
                updatedRecipe.steps.push(step);
            }
        });
        
        console.log('✅ الوصفة المحدثة:', updatedRecipe);
        
        localStorage.setItem('editRecipe', JSON.stringify(updatedRecipe));
        
        window.location.href = 'my-recipes.html';
        
    } catch (error) {
        console.error('❌ خطأ في الحفظ:', error);
        alert('حدث خطأ في حفظ التعديلات');
    }
});


loadRecipeData();
</script>

</body>
</html>